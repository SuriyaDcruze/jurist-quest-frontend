name: Deploy JuristQuest Frontend

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      # 1️⃣ Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2️⃣ Prepare frontend directory
      - name: Prepare frontend directory
        run: |
          sudo mkdir -p /var/www/juristquest-frontend
          sudo chown -R ec2-user:ec2-user /var/www/juristquest-frontend

      # 3️⃣ Sync code to server
      - name: Sync frontend code
        run: |
          rsync -av --delete \
            --exclude=.git \
            --exclude=node_modules \
            ./ /var/www/juristquest-frontend/

      # 4️⃣ Install Node.js dependencies
      - name: Install dependencies
        run: |
          cd /var/www/juristquest-frontend
          npm install

      # 5️⃣ Build the frontend
      - name: Build frontend
        run: |
          cd /var/www/juristquest-frontend
          npm run build

      # 6️⃣ Copy build output to Nginx directory
      - name: Deploy build to Nginx
        run: |
          sudo rm -rf /var/www/html/*
          sudo cp -r /var/www/juristquest-frontend/build/* /var/www/html/
          sudo chown -R nginx:nginx /var/www/html/
          sudo systemctl restart nginx
